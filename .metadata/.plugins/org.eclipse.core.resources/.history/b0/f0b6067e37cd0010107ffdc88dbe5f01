package com.loyalty.controllers;

import com.loyalty.dtos.LoyaltyLogDTO;
import com.loyalty.dtos.PointsTotalsDTO;
import com.loyalty.services.PointsService;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.responses.*;
import io.swagger.v3.oas.annotations.tags.Tag;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/points")
@Tag(name = "Points Management", description = "Endpoints to manage point history and totals")
public class PointsController {

    @Autowired
    private PointsService pointsService;

    // Historial de puntos del negocio autenticado
    @Operation(summary = "Historial completo de puntos del negocio",
               description = "Devuelve todas las transacciones de puntos del negocio autenticado")
    @ApiResponses({
        @ApiResponse(responseCode = "200", description = "Historial obtenido correctamente"),
        @ApiResponse(responseCode = "401", description = "Token inv√°lido"),
        @ApiResponse(responseCode = "500", description = "Error interno del servidor")
    })
    @GetMapping("/history/business")
    public ResponseEntity<Page<LoyaltyLogDTO>> getBusinessHistory(
            @RequestParam(defaultValue = "0") int page,
            @RequestParam(defaultValue = "15") int size) {

        Page<LoyaltyLogDTO> logs = pointsService.getBusinessHistory(page, size);
        return ResponseEntity.ok(logs);
    }

    // Historial de puntos de un usuario
    @GetMapping("/history/user/{id}")
    public ResponseEntity<Page<LoyaltyLogDTO>> getUserHistory(
            @PathVariable Long id,
            @RequestParam(defaultValue = "0") int page,
            @RequestParam(defaultValue = "15") int size) {

        Page<LoyaltyLogDTO> logs = pointsService.getUserHistory(id, page, size);
        return ResponseEntity.ok(logs);
    }

    // Totales de puntos del negocio autenticado
    @GetMapping("/totals")
    public ResponseEntity<PointsTotalsDTO> getBusinessTotals() {
        PointsTotalsDTO totals = pointsService.getBusinessTotals();
        return ResponseEntity.ok(totals);
    }
}

